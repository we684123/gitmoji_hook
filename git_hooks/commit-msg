#!/bin/sh

commit_msg_file="$1"
commit_source="$2"

# Debug è¼¸å‡º
echo "commit-msg hook triggered"
echo "commit_msg_file: $commit_msg_file"
echo "commit_source: $commit_source"
echo "\$3: $3"
echo

# æª¢æŸ¥æ˜¯å¦ç‚ºåˆä½µ commit
if [ "$commit_source" = "merge" ]; then
    target_branch=$(git symbolic-ref --short HEAD)

    # ä½¿ç”¨ git log ç²å– parent commit çš„ hash
    parent_commits=$(git log -1 --pretty=%P)
    echo "parent_commits: $parent_commits"

    # æå–ç¬¬äºŒå€‹ parent commit ä½œç‚ºä¾†æºåˆ†æ”¯çš„ commit
    source_commits=$(echo $parent_commits | awk '{print $2}')
    echo "source_commits: $source_commits"

    # ç²å–ä¾†æºåˆ†æ”¯åç¨±
    parent_branch=$(git branch --contains "$source_commits" | grep -v HEAD | head -n1 | xargs)
    echo "parent_branch: $parent_branch"

    # ä¿®æ”¹ commit è¨Šæ¯
    if [ -n "$parent_branch" ]; then
        echo "ðŸ”€ Merge branch '$parent_branch' into $target_branch" > "$commit_msg_file"
    else
        echo "Failed to determine source branch. Skipping commit message modification."
    fi
fi
